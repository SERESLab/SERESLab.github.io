<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Test</title>
</head>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.5.5/citation.min.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/citation-js"></script>
<script src="require.js" type="script"></script>
<script>
    const Cite = require("citation-js");
</script>
<style>
    .container {
        display: flex;
    }

    .filterable {
        margin: 5px;
        float: left;
        display: none;
    }

    .show {
        display: block;
    }

    .active {
        background-color: lightblue;
    }
</style>


<div id="fillable" class="elements">
</div>

<div class="container">
    <div class="filterable cars show">Challenger</div>
    <div class="filterable fruit show">Pear</div>
    <div class="filterable pets show id-7">Cat</div>
    <div class="filterable fruit show">Apple</div>
    <div class="filterable pets show">Dog</div>
    <div class="filterable cars show">Camaro</div>
    <div class="filterable cars show">Mustang</div>
    <div class="filterable pets show">Bird</div>
    <div class="filterable fruit cars show">Orange</div>
</div>

<body>
</body>
<script>

    const CITATIONS = "";
    getTags();

    const elementsContainer = document.getElementById("fillable");

    /*
    Return: fetches and parses the tags.json file, then calls createsClickables
            which then puts it on the DOM
    */
    async function getTags() {
        await fetch('./data/tags.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error("HTTP error " + response.status);
                }
                return response.json();
            })
            .then(json => {
                createClickables(json);
            })
            .catch(function () {
                this.dataError = true;
            })
    }

    /*
    Return: outputs the citations to the DOM with their respective publications
    */
    async function getCitations() {
        await fetch('./data/citationtest.bib')
            .then(response => {
                if (!response.ok) {
                    throw new Error("HTTP error " + response.status);
                }
                return response.text();
            })
            .then(data => {
                // do something here with the JSON
                generateCitations(data);
            })
            .catch(function () {
                this.dataError = true;
            })
            
    }

    /*
    Return: puts the formatted citations on the DOM
    String data: this is the parsed BibTeX file
    */
    function generateCitations(data) {
        let citations = new Cite(data);
        let output = citations.format('bibliography', {
            format: 'html',
            template: 'APA',
            lang: 'en-US',
        });
        elementsContainer.innerHTML(output);
    }

    // THIS FUNCTION NEEDS TO BE USED AS ASYNC FOR AN AWAIT CALL
    // This function creates a citation
    async function getCitationsObject(json) {

        let cite = new Cite(await getCitationsString());

        let output = citations.format('', {
            format: 'html',
            template: 'apa',
            lang: 'en-US',
        })

        // need authors' name in alphabetical order
        // 
        let authors = citation.data[0].author; // this is an array of objects
        var authorStrings = new Array();
        var authorNames = new Array();



        // for (let i = 0; i < authors.length; i++) {
        //     authorStrings.push(authors[i].given[0] + ". " + authors[i].family + " ");
        // }
        // console.log(authorStrings.toString());

    }

    /*
    Return: adds buttons to the DOM
    Object Tags: This is the JSON file that was parsed
    */
    function createClickables(tags) {
        for (let i = 0; i < tags.length; i++) {
            let button = document.createElement("button");
            button.innerText = tags[i].name;
            button.id = tags[i].name;
            button.onclick = function () { onClickFilter(button.id, "id-" + tags[i].id,) }

            // adding attributes for future use
            if (tags[i].active === "yes") {
                button.setAttribute("data-active", "true");
            } else {
                button.setAttribute("data-active", "false");
            }

            elementsContainer.appendChild(button);
        }
    }

    /* 
    Return: a function that filters based off the button that was clicked
    String buttonId: this is the ID of the button, it should be the same as the inner text
    String className: this is the className added to the publications to filter what's hidden and shown
    */
    function onClickFilter(buttonId, className) {
        let filterables = document.getElementsByClassName('filterable');
        let currentActive = document.getElementsByClassName('active');
        let button = document.getElementById(buttonId);
        // case 1: no other filters are active
        // add the clicked button to active and show just that class
        if (currentActive.length == 0) {
            button.classList.add('active');
            for (let i = 0; i < filterables.length; i++) {
                if (filterables[i].classList.contains(className)) {
                    filterables[i].classList.add('show');
                } else {
                    filterables[i].classList.remove('show');
                }
            }

            // case 2: clicking an active button
            // remove that button from active, show everything
        } else if (button.classList.contains('active')) {
            button.classList.remove('active');
            for (let i = 0; i < filterables.length; i++) {
                filterables[i].classList.add('show');
            }

            // case 3: there is another filter active
            // remove that button from active, hide the other class, show the
            // respective class
        } else {
            currentActive[0].classList.remove('active');
            button.classList.add('active');
            for (let i = 0; i < filterables.length; i++) {
                if (filterables[i].classList.contains(className)) {
                    filterables[i].classList.add('show');
                } else {
                    filterables[i].classList.remove('show');
                }
            }
        }

    }
</script>

</html>